
<script>
  // -----------------------------
  // Calendar (Shopify Redirect Version)
  // -----------------------------

  const START_HOUR = 7, END_HOUR = 20; 
  const bookings = {}; // No payment tracking needed anymore.

  function pad(n){ return String(n).padStart(2,'0'); }
  function ymd(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }
  function hourLabel(h){ return `${pad(h)}:00`; }

  // UI refs
  const monthBtn = document.getElementById('monthBtn'),
        weekBtn = document.getElementById('weekBtn'),
        prevBtn = document.getElementById('prevBtn'),
        nextBtn = document.getElementById('nextBtn'),
        labelEl = document.getElementById('label'),
        monthView = document.getElementById('monthView'),
        weekView = document.getElementById('weekView'),
        monthGrid = document.getElementById('monthGrid'),
        weekHeader = document.getElementById('weekHeader'),
        weekBody = document.getElementById('weekBody');

  let view = 'week';
  let cursor = new Date();

  function showMonth(){ view='month'; monthView.style.display='block'; weekView.style.display='none'; renderMonth(); }
  function showWeek(){ view='week'; monthView.style.display='none'; weekView.style.display='block'; renderWeek(); }

  monthBtn.addEventListener('click', showMonth);
  weekBtn.addEventListener('click', showWeek);

  prevBtn.addEventListener('click', ()=>{
    if(view==='week'){ cursor.setDate(cursor.getDate() - 7); renderWeek(); }
    else { cursor.setMonth(cursor.getMonth() - 1); renderMonth(); }
  });

  nextBtn.addEventListener('click', ()=>{
    if(view==='week'){ cursor.setDate(cursor.getDate() + 7); renderWeek(); }
    else { cursor.setMonth(cursor.getMonth() + 1); renderMonth(); }
  });

  // --- Shopify Redirect Handler ---
  function redirectToShopify(date, hour){
    const shopURL = "https://huanger-films.myshopify.com/";
    window.location.href = shopURL + `?date=${date}&time=${hour}`;
  }

  // --- Month View ---
  function renderMonth(){
    monthGrid.innerHTML = '';
    const year = cursor.getFullYear(), month = cursor.getMonth();
    labelEl.textContent = cursor.toLocaleString(undefined,{month:'long', year:'numeric'});

    const first = new Date(year, month, 1);
    const startDay = first.getDay();
    const startDate = new Date(first);
    startDate.setDate(first.getDate() - startDay);

    for(let i=0;i<42;i++){
      const d = new Date(startDate);
      d.setDate(startDate.getDate() + i);
      const key = ymd(d);

      const el = document.createElement('div');
      el.className = 'day-card';
      el.dataset.date = key;

      const dayNum = document.createElement('div');
      dayNum.className='day-num';
      dayNum.textContent = d.getDate();
      el.appendChild(dayNum);

      const weekday = document.createElement('div');
      weekday.className='small-muted';
      weekday.textContent = d.toLocaleDateString(undefined,{weekday:'short'});
      el.appendChild(weekday);

      const slotsWrap = document.createElement('div');
      slotsWrap.style.marginTop='8px';

      for(let h = START_HOUR; h < Math.min(START_HOUR+4, END_HOUR); h++){
        const s = document.createElement('span');
        s.className = 'slot available';
        s.textContent = hourLabel(h);
        s.onclick = (ev)=>{ ev.stopPropagation(); redirectToShopify(key, h); };
        slotsWrap.appendChild(s);
      }

      el.appendChild(slotsWrap);
      monthGrid.appendChild(el);
    }
  }

  // --- Week View ---
  function getWeekStart(d){
    const dd = new Date(d);
    const day = dd.getDay();
    const mon = new Date(dd);
    mon.setDate(dd.getDate() - (day === 0 ? 6 : day - 1));
    return mon;
  }

  function renderWeek(){
    weekHeader.innerHTML = '';
    weekBody.innerHTML = '';

    const mon = getWeekStart(cursor);
    const dates = [];

    weekHeader.innerHTML += `<div style="background:#f3f4f6"></div>`;

    for(let i=0;i<7;i++){
      const dt = new Date(mon);
      dt.setDate(mon.getDate() + i);
      dates.push(dt);

      const th = document.createElement('div');
      th.style.padding = '8px';
      th.style.fontWeight = '600';
      th.style.background = '#fafafa';
      th.textContent = dt.toLocaleDateString(undefined,{weekday:'short', month:'short', day:'numeric'});
      weekHeader.appendChild(th);
    }

    labelEl.textContent = `${dates[0].toLocaleDateString()} â€“ ${dates[6].toLocaleDateString()}`;

    for(let h = START_HOUR; h < END_HOUR; h++){
      const timeCell = document.createElement('div');
      timeCell.className = 'time-cell';
      timeCell.innerHTML = `<strong>${hourLabel(h)}</strong>`;
      weekBody.appendChild(timeCell);

      for(let i=0;i<7;i++){
        const dt = dates[i];
        const key = ymd(dt);

        const cell = document.createElement('div');
        cell.className = 'day-col';

        const slot = document.createElement('div');
        slot.className = 'hour-box hour-available';
        slot.textContent = 'Available';

        slot.onclick = ()=>redirectToShopify(key, h);

        cell.appendChild(slot);
        weekBody.appendChild(cell);
      }
    }
  }

  showWeek();
</script>

